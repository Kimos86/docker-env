version: '2'

services:
    fhem:
        expose:
            - "8083"
            - "7072"
#            - "51826"
        ports:
            - "8083:8083"
            - "7072:7072"
#            - "51826:51826"
        build: fhem
        privileged: true
        stdin_open: true
        tty: true
        networks:
            - code-network
#       devices:
        volumes:
            - ./fhem/supervisord.conf:/etc/supervisor/conf.d/supervisord.conf
            - ./fhem/start.sh:/opt/fhem/start.sh
            - ./fhem/data/Abfallkalender/muellkalender.ics:/opt/data/muellkalender.ics
            - /docker/fhem_recover/:/opt/fhem/
            - /docker/backup:/opt/fhem/backup
        depends_on:
            - "mysql"

    homebridge:
        expose:
            - "51826"
            - "8282"
            - "5353"
        ports:
            - "51826:51826"
            - "8282:8282"
            - "5353:5353"
        build: homebridge
#        privileged: true
        stdin_open: true
        tty: true
        networks:
            - code-network
#       devices:
        volumes:
            - ./homebridge/start.sh:/root/start.sh
            - ./homebridge/config.json:/root/.homebridge/config.json
            - ./homebridge/supervisord.conf:/etc/supervisor/conf.d/supervisord.conf
            - ./homebridge/homebridge.sh:/etc/init.d/homebridge.sh
        depends_on:
            - "fhem"

    mysql:
        expose:
            - "3306"
            - "33060"
        ports:
            - "3306:3306"
            - "33060:33060"
        image: mysql/mysql-server:5.7
#        privileged: true
#        stdin_open: true
        tty: true
        environment:
            - MYSQL_RANDOM_ROOT_PASSWORD=yes
#            - MYSQL_ROOT_PASSWORD=123
        networks:
            - code-network
#       devices:
        volumes:
            - ./mysql/init.sql:/docker-entrypoint-initdb.d/fhem-init.sql
            - /docker/mysql_recover/data:/var/lib/mysql

#        depends_on:


networks:
    code-network:
        driver: bridge    
